{% import 'macros.j2' as macros -%}

## API: compose.mk

### compose.mk: (Dynamic Targets)

The autogenerated section of the API (i.e. what's created by `compose.import`) is documented as part of the [Make/Compose Bridge](/#makecompose-bridge).

### compose.mk: (Static Targets)

This is the complete list of namespaces & public targets available from `compose.mk`, along with their documentation.  Most documentation is pulled automatically from [the latest source](/compose.mk).  Some important notes about how these targets work:

* **No requirements for `k8s-tools.yml` or `k8s.mk`.**
* **Targets are usable interactively from your shell** as `make <target>` or `./compose.mk <target>`
* **Targets are usable as an API,** either as prereq-targets or as part of the body in your project automation.
* **Most targets are pure shell, and have no exotic dependencies.** That means that they generally run fine on host or as dispatched targets inside containers.  *(Exceptions: targets in `stream.json.*` require `jq` and targets in `docker.*` require docker.)*
* **Target names are reserved names after declaration.**

Things are organized into a few namespaces, which hopefully avoids collisions with your project targets.

* [*`io.*`* targets:](#api-io)  Misc text-formatters, timers, and other utilities
* [*`docker.*`* targets:](#api-docker) targets: Simple helpers for working with docker.
* [*`flux.*`*](#api-flux) targets: Miniature workflow library / pipe wizard.
* [*`tux.*`*  targets:](#api-tux) targets: Embedded TUI support.
* [*`make.*`*  targets:](#api-tux) targets: Low-level helpers for working with make.
* [*`stream.*`* targets:](#api-stream) targets: Support for IO streams, including basic stuff with JSON, newline-delimited, and space-delimited formats.

{% set help_extra="Docs below typically refer to `compose.mk` as the executable involved, but if you're using integrated rather than stand-alone mode, you should use `make` instead to work with your own project's context!" %}

#### API: tux

The *`tux.*`* targets allow for creation, configuration and automation of an embedded TUI interface.  See the [TUI documentation](/#embedded-tui) for a high-level overview of what this is and how it works.  For more details, [see the main TUI docs](/#embedded-tui), read on into the API, or see the [tux container spec in compose.mk]({{macros.search_link('compose.mk', 'tux', github)}})

{{macros.parse_help('compose.mk', 'tux', help_extra)}}

#### API: io

The *`io.*`* targets cover various I/O helpers, text-formatters, and other utilities.

{{macros.parse_help('compose.mk', 'io', github)}}

#### API: docker

The *`docker.*`* targets cover a few helpers for working with docker.  This interface is deliberately minimal, focusing on verbs like 'stop' and 'stat' more than verbs like 'build' and 'run'.  That's because containers that are managed by `docker compose` are preferred, but some ability to work with inlined Dockerfiles for simple use-cases is supported.  See [`stream.pygmentize`](#streampygmentize) for an example.

{{macros.parse_help('compose.mk', 'docker', github)}}

#### API: flux

The *`flux.*`* targets describe a miniature workflow library.  Combining `flux` with [container dispatch](/#container-dispatch) is similar in spirit to things like [declarative pipelines in Jenkins](https://www.jenkins.io/doc/book/pipeline/syntax/#declarative-pipeline), but simpler, more portable, and significantly easier to use.  

So what's a workflow?  Well, bash by itself is fine for what you might call "process algebra", and using operators like `&&`, `||`, `|` in the grand unix tradition does a lot of work.  Adding `make` to the mix already provides DAGs.  

What `flux.*` targets add is higher-level join/loop/map operations *over other make targets*, taking inspiration from functional programming and threading libraries.  For stuff that's more specific to shell code, see `flux.*.sh`, and for working with scripts see `flux.*.script`.  See also the [Platform Setup Example](/docs/demos.md#demo-platform-setup) for a more complete walk-through of motivation, starting from an example use-case.

{{macros.parse_help('compose.mk','flux', github)}}

#### API: gum

The `gum.*` targets support usage of [charmbracelet/gum](#).  These targets generally use gum natively if available, falling back to using [tux](#api-tux).  See also [`io.print.*`](#api-io).

{{macros.parse_help('compose.mk', 'gum', github)}}

#### API: stream

The `stream.*` targets support IO streams, including basic stuff with JSON, newline-delimited, and space-delimited formats.

{{macros.parse_help('compose.mk', 'stream', github)}}

